language: java
jdk:
  - openjdk11
addons:
  apt:
    packages:
      - docker-ce
before_install:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS registry.heroku.com
script:
  - "./gradlew build --info"
after_success:
  - docker build -f Dockerfile --iidfile imageid.txt -t registry.heroku.com/brain-heap .
  - docker push registry.heroku.com/brain-heap
  - apk add --no-cache curl
  - echo "Docker Image ID is $(cat imageid.txt)"
  - curl -X PATCH --header "Content-Type:application/json" --header "Accept:application/vnd.heroku+json; version=3.docker-releases" --header "Authorization:Bearer ${HEROKU_API_KEY}" --data "{\"updates\":[{\"type\":\"web\",\"docker_image\":\"'$(cat imageid.txt)'\"}]}"  https://api.heroku.com/apps/brain-heap/formation
after_failure:
  - cat target/surefire-reports/*.txt
notifications:
  slack: neueda-technologies:ZYh2b6u5OcMbhwMu6i9U47fQ
  email:
    recipients:
      - innulic@mail.ru
      - a.a.zarubina@gmail.com
      - aflammaal@gmail.com
    on_success: change
    on_failure: always
env:
  global:
    - secure: "aPRFFwM35DI/oPSZi2b3BYKpGNremsNvMPSbf39LG+JPfGDh6l4hX4MlbEU8i8yVc5vUfYmReRrm1ZKnW7e2pXmzi0GiTIAZYEqrummOLMbQIatMvfLOiW0Zl2dTqtqAFSnKjHUb2lndKH46GGUFtcW52ct8BKXvdc3oSq3AqPTOwYIUm/3SH4VZDfWhz5TD3pfSNL/38NlHBek1f6z+sGhQ9ijMPt44ejxxBPSoBnxohZHvzJL+VdTxHf5ISG+VaBG4HKNuxYsinswXH1WuprH2C8N51txz3VG1lwQauj41bIDX+KWGbjgNlLxLB2yuZg+TLUv5aH1T6IGDJyZCaoggI/FEvVAbJ0Tf/TzBVtOJwpTRTM5SFt86RrTSZ6IHjk3aGKUJKgJ8BvU25yofSHL+BrXClM9fTdPXYSTyJJwHREzUVYi/YnRbNgj5MLszSbLG2pcN5d9rx7yyiSXSxwu0KdYv2wNMlNbsexqln5WydOt3C55SqhVbvN2OWN/HSOHnyqO/1PZ4/U/yyKol4r705mfForAk8gDLGpeh4nAyaHm0ie6IxHySq4P9Hkb23xhi17D9ApXMnoFIPwiWZo+zSfh8nbeW0fkx6ciltoBLaNItIgzLmNugu4GEwRcfh1OCOyUETHodbj7ov3sr++O1yuzFJ/ioCdfIfuFY6JA="
    - secure: "Sz4QnmQQnbHuKkm2Fmu0c20LMBRoh0B89EWVUn5B6g80fUdSKB7058Lrqx+rESOTmyD+mD90Bk7xQnHsW7ulP2BzIpwfgsYZ0GR7FKZsvETfUPD/PR71sfCsKvX9XwwCRAi888RN/cH/hn8g5O/YeOEWWhM+GyFeTi4IBvliadwZjKsIZBo7hv5vFRAM7IPyKMp0H76rvAYU6XT3mubfdbS4ta194MlC4KHmH/hPj9ugZ1cqK5ZkBEAd+t7r3wkcEOqXwOyotN6a9QwI/ZdWdLLFpkYHYa4RpBGca8mCIA6wkyg6N0zLaNAwDgUn7qtPQiu5XBM+Z+GUfM6o7QJS2kvodId7IWrKPjIMgz8VSGwWYs+7dZsKTUUxicqYVwxeKa6gTV+ukEF5Nb2ygELVtzc3SAOmIGFu7BQLcHph42UeJmFbBujv/z0eZHn0R1lDeomrWK3tCG/zlUuTfPmTA7atS64xGA8Xid3Cpw7cnDyoSEPfc2QeV2zKsIht3qwKgV9yB0mxYnP5Uw5klzHB381MmT98MNRU+G8M2SFirKO41XIHJA2j42U7keyR5rgFEsLJ88Tobz0XUF3cHddknkfQi0bhN1m68i5PR22z/mQD8HbiJ8Opom6/Cvko9ojPwVzwc0TtkBsTv1tXaY3u2nddyzPKiAQHPZeVT2tELaU="
    - secure: "ggmOxSlbpy/vE7Oj8HNEK19Rk8wLNLQ7rGD3fMihiWq/dJLUH4f0oaEBZ0WUnuU9mA9O7JoAUiTPYmDTOdqgGexboHZHLU9SuZLjP0yFnQt1qdSVnUwuT3H1UYvT3dgBSf7vJfM6+vrNx4Bs4Bxe71QMeSGQMqeqNKHfELMd+Qm0M58qmVapTumwWIDtmi7WpmgMU3lfSGbU+BTxc6o3dQ9Norx3CbrPOpiQuO3khfJ/zqOW52rjQ5d89nBvO9oCOHoEyoRwWNyCXzgQ7fVswKYQBapIO3AQAiphBbTGhArfwfhANvJzHIaVKFcLDyrkrI6OMkegXj7z55hXh/mKa+ICT/wkxsnJIjkKrmjd46fOm1HJ4izrwLhTiVM+AqxlKr5waQiEoJ8V9iqiMx/gs3MguKrp8GjWGP+8SwQ6SbvA1rWHn9g53WUxyWNZcoCWZrju4nILc0e1RBtKtsivvYg5ZfkbFmg3pVI77WjG72a2X1lyj1o0mSTJEAzQQvMQpzLCjbqVmrWNnh3p0LYhIIpxg/NCwZxOmqebP6jYyv22MGm9enNQ38Rxx4Y3T0CFZgLJI1yYkEVmhReElQV5LqW5cBNUCsr5RYI+cWOP8Zv2uXA/Wn986LXK6rNZH/twgH3KV6+i7xm4yct6BJ/XFfeFm6UPgUioJ8v7zfBC5Y0="
