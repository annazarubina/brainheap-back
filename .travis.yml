language: java
jdk:
  - openjdk11
addons:
  apt:
    packages:
      - docker-ce
before_install:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS registry.heroku.com
script:
  - "./gradlew build --info"
after_success:
  - docker build -f Dockerfile --iidfile imageid.txt -t registry.heroku.com/brain-heap .
  - docker push registry.heroku.com/brain-heap
  - apk add --no-cache curl
  - echo "Docker Image ID is $(cat imageid.txt)"
  - curl -X PATCH --header "Content-Type:application/json" --header "Accept:application/vnd.heroku+json; version=3.docker-releases" --header "Authorization:Bearer ${HEROKU_API_KEY}" --data "{\"updates\":[{\"type\":\"web\",\"docker_image\":\"'$(cat imageid.txt)'\"}]}\"  https://api.heroku.com/apps/brain-heap/formation
after_failure:
  - cat target/surefire-reports/*.txt
notifications:
  slack: neueda-technologies:ZYh2b6u5OcMbhwMu6i9U47fQ
  email:
    recipients:
      - innulic@mail.ru
      - a.a.zarubina@gmail.com
      - aflammaal@gmail.com
    on_success: change
    on_failure: always
env:
  global:
    - secure: "aPRFFwM35DI/oPSZi2b3BYKpGNremsNvMPSbf39LG+JPfGDh6l4hX4MlbEU8i8yVc5vUfYmReRrm1ZKnW7e2pXmzi0GiTIAZYEqrummOLMbQIatMvfLOiW0Zl2dTqtqAFSnKjHUb2lndKH46GGUFtcW52ct8BKXvdc3oSq3AqPTOwYIUm/3SH4VZDfWhz5TD3pfSNL/38NlHBek1f6z+sGhQ9ijMPt44ejxxBPSoBnxohZHvzJL+VdTxHf5ISG+VaBG4HKNuxYsinswXH1WuprH2C8N51txz3VG1lwQauj41bIDX+KWGbjgNlLxLB2yuZg+TLUv5aH1T6IGDJyZCaoggI/FEvVAbJ0Tf/TzBVtOJwpTRTM5SFt86RrTSZ6IHjk3aGKUJKgJ8BvU25yofSHL+BrXClM9fTdPXYSTyJJwHREzUVYi/YnRbNgj5MLszSbLG2pcN5d9rx7yyiSXSxwu0KdYv2wNMlNbsexqln5WydOt3C55SqhVbvN2OWN/HSOHnyqO/1PZ4/U/yyKol4r705mfForAk8gDLGpeh4nAyaHm0ie6IxHySq4P9Hkb23xhi17D9ApXMnoFIPwiWZo+zSfh8nbeW0fkx6ciltoBLaNItIgzLmNugu4GEwRcfh1OCOyUETHodbj7ov3sr++O1yuzFJ/ioCdfIfuFY6JA="
    - secure: "XZVWuTtgX9UkOUtgUfQAEOf93rvmFfagVoWluTVvH5dWmfjrGVPi90UU/ePy5MJ9uNCAUo0Fd24/sAjqHm1vUgskBgRoOwwqkVRGwd+E+tWtDjnZ7x0p/iP6/XPFufH9EBrl9ZeqyX6VuAxLE3F2h7CQhjyEXsiQQ65YD+Klp5fwCv3iXiEYzp15+mhQvCL9tyYTKlhZX8T7yjZeBPICW20IKMzEGOKBN5GFjM4raiHnhaINiklu2gPWT+xTKVVIn6Yqi9Jw5/3ASxp2pZgvACh+Chjvy8cmQU9erncAZdfYVu9MZf4L1cn8+N1jDoxnDLG3E1oo2Vi6rKiGuU/YKgfXwWCEnPED88wlZl7CvIMwnAvec30v7WHotWlkQzKjMhfbWRv9lfKGdyBH9vR8/0vrZAw9uvnSqGpcEHstVCLUC7aJujZnrPcvchgrHgztWhQnH58CFy1bhYI4uO2B5sJXTN9j4cZ/Rx4gae0M/S0o0IUbtNHL0dRlDdgg1htQqnaZ+4ujJzEbJQt8EowcDvogpVQGgpTe2BfFv0Xleci2dBD2fxfuEuTV5yXRMcp2zIq2Wex0Hu9Cubym5RgBp3Q+sFbpT1keZsJ1e0ikNV3hkPE+1pyLoSxEpGCqRfKDPcLhQdiTgeI7m5Fz9r01BUpXmh2UjtvxnpXvpIMnuJY="
    - secure: "Sz4QnmQQnbHuKkm2Fmu0c20LMBRoh0B89EWVUn5B6g80fUdSKB7058Lrqx+rESOTmyD+mD90Bk7xQnHsW7ulP2BzIpwfgsYZ0GR7FKZsvETfUPD/PR71sfCsKvX9XwwCRAi888RN/cH/hn8g5O/YeOEWWhM+GyFeTi4IBvliadwZjKsIZBo7hv5vFRAM7IPyKMp0H76rvAYU6XT3mubfdbS4ta194MlC4KHmH/hPj9ugZ1cqK5ZkBEAd+t7r3wkcEOqXwOyotN6a9QwI/ZdWdLLFpkYHYa4RpBGca8mCIA6wkyg6N0zLaNAwDgUn7qtPQiu5XBM+Z+GUfM6o7QJS2kvodId7IWrKPjIMgz8VSGwWYs+7dZsKTUUxicqYVwxeKa6gTV+ukEF5Nb2ygELVtzc3SAOmIGFu7BQLcHph42UeJmFbBujv/z0eZHn0R1lDeomrWK3tCG/zlUuTfPmTA7atS64xGA8Xid3Cpw7cnDyoSEPfc2QeV2zKsIht3qwKgV9yB0mxYnP5Uw5klzHB381MmT98MNRU+G8M2SFirKO41XIHJA2j42U7keyR5rgFEsLJ88Tobz0XUF3cHddknkfQi0bhN1m68i5PR22z/mQD8HbiJ8Opom6/Cvko9ojPwVzwc0TtkBsTv1tXaY3u2nddyzPKiAQHPZeVT2tELaU="
